  

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <title>Leaflet Maps</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,200;0,400;0,700;1,400&display=swap"
            rel="stylesheet">
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
            integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
            crossorigin="" />
        <link rel="stylesheet" href="./style.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    
    <body>
      
      <main> 
        
            <div   class="scroll gisdatalist">
                <div class="heading">
                    <h2>Flood Data</h2>
                </div>
                   <div id="Start"> <form  >
                        <label for="start-date">Flood Start date:</label>
                        <input type="date" id="startdate" name="birthday">
                        
                      </form></div>
                    <div id="End">   <form action="/action_page.php">
                        <label for="end-date">Flood End date:</label>
                        <input type="date" id="enddate" name="birthday">
                        
                      </form>
                      </div>
                  
                      <div class="dropdown" id="Countrydrop">
                      <form action="/action_page.php">
                        <label for="cars">Country:</label>
                        
                        <select id="countries" name="countries">
                          <option value="India">India</option>
                          <option value="Indonesia">Indonesia</option>
                          <option value="Japan">Japan</option>
                          <option value="Laos">Laos</option>
                          <option value="Thailand">Thailand</option>
                        </select>
                    </form>   
                       
                    </div>
                    <div id="satellites"> 
                        
                <form action="/action_page.php">
                    <label>Satellite Sensors:</label>
                    <input type="checkbox" id="sat1" name="sat1" value="Planet">
                    <label for="vehicle1">Planet</label>  
                    <input type="checkbox" id="sat2" name="sat2" value="Digital Globe">
                    <label for="vehicle2">Digital Globe</label><br>
                    <input type="checkbox" id="sat3" name="sat3" value="Sentinal-I">
                    <label for="vehicle3">Sentinal-I</label>  
                    <input type="checkbox" id="sat4" name="sat4" value="Sentinal-II">
                    <label for="vehicle3">Sentinal-II</label> 
                  </form>
                </div>
                <div id="submitbutton"> 
                 <button type="button" onclick="getVal();"  class="btn btn-primary">
                    <font color="white"> Submit</font>
        </button></div>
       <div id="daterange">  <h4 id="some">Flood Range</h4></div>
       <div class ="flooddataclass "id="datalist"  >
       
        
          
       </div>
            </div>
        <div id="map"> <div class="heading">
          <h2>Flood Data</h2>
      </div></div></main>
     
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
        <script src="./app.js"></script>
        
      
    </body>
    
    </html>
    <script>
     
    var footprint;
    var coordinatesarray;
    var cell_data;
    var actualdata;
    var country;
    var s1,s2,s3,s4;
    var satellites;
    var employee_data;
    var flooddatasearch;
    var csvflooddata;
     var ispaused=false;
     var issubmit=false;
     var startdate;
     var enddate;
     var setstart;
     var setend;
     var requireddata=[];
     var finaldata=[];
     var floodname=[];
     var csvfloodsarray=[];
     var selectcountry;
       
       $(document).ready(function(){
      
        $.ajax({
         url:'https://agile-hollows-34401.herokuapp.com/flooddata',
         type: 'GET',
         
         success:function(allflood)
         { 
       
          actualdata=allflood;
          console.log(actualdata);
        if(typeof(actualdata)=="object"){
          issubmit=true;
        }
        
      
     }
         ,
         error:function(error)
         { 
          console.log(error);
           
          }
        });
      
       
      });
     
      function formatDate (input) {
      var datePart = input.match(/\d+/g),
      year = datePart[0] , // get only two digits
      month = datePart[1], day = datePart[2];
    
      return day+'/'+month+'/'+year;
    }
       
  function getVal(){
    requireddata.length=0;

      
      var x = document.getElementById("startdate").value
       var  y= document.getElementById("enddate").value
       selectcountry= document.getElementById("countries").value;
       if(document.getElementById("sat1").checked ===true){
       s1= document.getElementById("sat1").value;}
       if(document.getElementById("sat2").checked ===true){
       s2= document.getElementById("sat2").value;}
       if(document.getElementById("sat3").checked ===true){
       s3= document.getElementById("sat3").value;}
       if(document.getElementById("sat4").checked ===true){
       s4= document.getElementById("sat4").value;}
       x = x.replace(/\-/g, '/');
       y=y.replace(/\-/g, '/');
         setstart=formatDate(x);
         setend=formatDate(y);
         
     
    
     
      // var flooddatasearch = JSON.parse(actualdata);
     
    
    for(var j=0;j<actualdata.length;j++){
    
           
        
          startdate=actualdata[j]["StartDate"];
          enddate=actualdata[j]["EndDate"];
          country=actualdata[j]["CountryName"];
          satellites=actualdata[j]["SatelliteName"];
          var d1 = setstart.split("/");
    var d2 =setend.split("/");
    var c1 = startdate.split("/");
    var c2=enddate.split("/");
    var from = new Date(d1[2], parseInt(d1[1])-1, d1[0]);  // -1 because months are from 0 to 11
    var to   = new Date(d2[2], parseInt(d2[1])-1, d2[0]);
    var check1 = new Date(c1[2], parseInt(c1[1])-1, c1[0]);
    var check2 = new Date(c2[2], parseInt(c2[1])-1, c2[0]);
    if((check1 > from && check1 < to)&&(check2 > from && check2 < to)&&selectcountry===country && (s1===satellites ||s2===satellites||s3===satellites||s4===satellites)){
         console.log("in date range" +selectcountry);
         requireddata.push(actualdata[j]["FloodCSVData"]);
         floodname.push("Flood data-"+country+" from "+startdate+" to "+enddate +" "+satellites+" data");
    }
     else if(j==actualdata.length-1 &&requireddata.length==0){
       alert("no data found");
     }
    // console.log(check1 > from && check1 < to);
    // console.log("to");
    // console.log(check2 > from && check2 < to);
    }
    
     
    if(requireddata.length !=0){
    for(var l=0;l<requireddata.length;l++){
    for(var k=0;k<requireddata[l].length;k++){
      requireddata[l][k]["footprint"]= JSON.stringify(requireddata[l][k]["footprint"]);
      
       
      if(k==requireddata[l].length-1){
        ispaused=true;
      }
     }
    }
    console.log(requireddata);
    //convert json to csv 
    for(var f=0;f<requireddata.length;f++){
      for(var g=0;g<requireddata[f].length;g++){
        delete requireddata[f][g]["permissions"];
        delete requireddata[f][g]["links_self"];
        delete requireddata[f][g]["links_assets"];
        delete requireddata[f][g]["links_thumbnail"];
        delete requireddata[f][g]["clear_confidence_percent"];
        delete requireddata[f][g]["clear_percent"];
        delete requireddata[f][g]["columns"];
        delete requireddata[f][g]["ground_control"];
        delete requireddata[f][g]["heavy_haze_percent"];
        delete requireddata[f][g]["light_haze_percent"];
        delete requireddata[f][g]["pixel_resolution"];
        delete requireddata[f][g]["published"];
         delete requireddata[f][g]["publishing_stage"];
         delete requireddata[f][g]["quality_category"];
         delete requireddata[f][g]["rows"]; 
         delete requireddata[f][g]["satellite_id"];
         delete requireddata[f][g]["shadow_percent"];
         delete requireddata[f][g]["snow_ice_percent"];
         delete requireddata[f][g]["strip_id"];
         delete requireddata[f][g]["sun_azimuth"];
         delete requireddata[f][g]["link"];
         delete requireddata[f][g]["sun_elevation"];
         delete requireddata[f][g]["updated"];
         delete requireddata[f][g]["view_angle"];
         delete requireddata[f][g]["visible_confidence_percent"];
         delete requireddata[f][g]["visible_percent"];
  

      }
    flooddatasearch=requireddata[f];
    console.log(requireddata[f]);
    var fields = Object.keys(flooddatasearch[0])
    var replacer = function(key, value) { return value === null ? '' : value } 
     csvflooddata =flooddatasearch.map(function(row){
      return fields.map(function(fieldName){
        return JSON.stringify(row[fieldName], replacer)
      }).join(',')
    })
    csvflooddata.unshift(fields.join(',')) // add header column
    csvflooddata  = csvflooddata.join('\r\n');
    csvfloodsarray.push(csvflooddata);
  }
        document.getElementById("some").innerHTML="Flood "+"Data "+ setstart +" to "+setend;
        // document.getElementById("load_data").innerHTML="Load Data";
        if(issubmit){
     var text = "<ol class='list'  ><br>";
        for (var i =0;i<requireddata.length;i++)
        {   
         
          if(i>0){text=text+"<hr style='height:1px;border-width:0px;color:gray;background-color:gray'/>";}  
                 text = text + "<li  name='load_data' id='#load_data'  onclick='Loadcsv("+i+");' ><img src='csvicon.png'  style='height:48px;width:48px; border-radius:25%;  border: 1px solid #0e75d3;'>"+"  <b><font style='color:#0e75d3'>"+floodname[i] +"</font></b></li> <br /> <div id='employee_table"+i+"' style='overflow: auto;'></div> " ;
                
        
        }
     text = text +"</ol>";
      }
      else{
        alert("submit again");
      }
     document.getElementById('datalist').innerHTML=text; 
     
     
    }
     
        // document.getElementById("data2").innerHTML="employee1.csv";
        // document.getElementById("data3").innerHTML="employee2.csv";
        // document.getElementById("data4").innerHTML="employee3.csv";
    }

function flytoloaction(i){
  map.flyTo([requireddata[i][0]["Latitude"],requireddata[i][0]["Longitude"]],8,{
    duration:3
  })
 var a=requireddata[i][0]["Latitude"];
 var b=requireddata[i][0]["Longitude"];
 var x=a-1
 var y=a+1
 var  x1=b-1
 var y1=b+1
   
    var latlngs = [ [ x,x1],[ x, y1 ], [ y, y1 ], [ y, x1 ], [x, x1 ]];
    var polygon = L.polygon(latlngs, {color: 'red'}).addTo(map);

// // zoom the map to the polygon
// map.fitBounds(polygon.getBounds());
}

 
function Loadcsv(i){
       
       flytoloaction(i);
       if(ispaused){
     
      employee_data =csvfloodsarray[i].split(/\r?\n|\r/);
          var table_data = '<table class="table table-bordered table-striped"  > ';
          for(var count = 0; count<employee_data.length; count++)
          {     
                  //you will get acctual output in array
            
                cell_data = employee_data[count].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
           table_data += ' <tr id="roweve"  onclick="rowclick(this)"  >  ';
           for(var cell_count=0; cell_count<cell_data.length; cell_count++)
           {
            if(count === 0)
            {
             table_data += '  <th>  '+cell_data[cell_count]+'</th>';
               
            }
            
            else{
              table_data += '<td>'+cell_data[cell_count]+'</td>';
            }
           }
           table_data += '</tr>';
          }
          table_data += '</table>';
          
          // for(var j=0;j<allflood.length;j++){
        // if(i==j){
      document.getElementById('employee_table'+i+'').style.height = 30+"vh";
       $('#employee_table'+i+'').html(table_data);
    // } }
     
        }
         }
    
    
         
    function rowclick(rowno){
       
     let msg=rowno.cells[4].innerHTML;
     
     var WithOutBrackets=msg.replace(/[\[\]']+/g,'');
     var me=WithOutBrackets.replace(/"/g,"");
             
    //   var obj=  JSON.parse( WithOutBrackets   );
     //alert(typeof(me));
     //we have to do string to integer and understand about how array convert into chunk array
    
      var  coordinates=  me.split(',');
      console.log( coordinates);
    const chunk =  coordinates => {
       const size = 2;
       const chunkedArray = [];
       for (let i = 0; i <  coordinates.length; i++) {
          const last = chunkedArray[chunkedArray.length - 1];
          if(!last || last.length === size){
             chunkedArray.push([ coordinates[i]]);
          }else{
             last.push( coordinates[i]);
          }
       };
       return chunkedArray;
    };
     
           alert(chunk( coordinates));
        var states = [{
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "Polygon",
            "coordinates":[[["129.86889616213875", "31.85092400331079"], ["130.13226059277255", "31.804015706859424"], ["130.11415527263486", "31.731335321675704"], ["129.85082873777677", "31.77787200251359"], ["129.86889616213875", "31.85092400331079"]]]
           }
    
    }];
     states[0]["geometry"]["coordinates"]=[chunk( coordinates)];
    console.log(states);
    L.geoJSON(states, {
        style: function(feature) {
            switch (feature.properties.party) {
                case 'Republican': return {color: "#ff0000"};
                case 'Democrat':   return {color: "#0000ff"};
            }
        }
    }).addTo(map);
    
    }
    function myFunction() {
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}
    
     //  fetch("https://agile-hollows-34401.herokuapp.com/flooddata").then((response) =>{
        
    //     return response.json();
    //   }).then((actualdata)=>{
    //     allflood=actualdata;
    //     if(typeof(allflood)=="object"){
    //       issubmit=true;
    //     }
      
     
    //   // var flooddatasearch = JSON.parse(actualdata);
    // for(var i=0;i<actualdata[0]["FloodCSVData"].length;i++){
    //   actualdata[0]["FloodCSVData"][i]["geometry"]= JSON.stringify(actualdata[0]["FloodCSVData"][i]["geometry"]);
       
      
    //   if(i==actualdata[0]["FloodCSVData"].length-1){
    //     ispaused=true;
    //   }
    //  }
    
    // for(var j=0;j<actualdata.length;j++){
    //       startdate=actualdata[j]["StartDate"];
    //       enddate=actualdata[j]["EndDate"];
    // }
      
     
    // flooddatasearch=actualdata[0]["FloodCSVData"];
    // var fields = Object.keys(flooddatasearch[0])
    // var replacer = function(key, value) { return value === null ? '' : value } 
    //  csvflooddata =flooddatasearch.map(function(row){
    //   return fields.map(function(fieldName){
    //     return JSON.stringify(row[fieldName], replacer)
    //   }).join(',')
    // })
    // csvflooddata.unshift(fields.join(',')) // add header column
    // csvflooddata  =  csvflooddata.join('\r\n');
     
     
    
    //   }).catch((error)=>{
    //     console.log(error);
    //   });
    
    
    //   $.ajax({
    //   url: 'https://agile-hollows-34401.herokuapp.com/flooddata',
    //   dataType: 'json',
    //   success: function(data) {
    //     console.log(data);
    //   }
    // });
    // fetch('https://randomuser.me/api/?results=10').then(function(response) {
    //   return response.json();
    // }).then(function(json) {
    //   let products = json;
    //   initialize(products);
    // }).catch(function(err) {
    //   console.log('Fetch problem: ' + err.message);
    // });
    
     
     
    
    
      //   $(document).ready(function(){
      //  $('#load_data').click(function(){ alert(country);
      //   $.ajax({
      //    url:'employee.csv',
      //    dataType:"text",
      //    crossOrigin: true,
      //             type: 'GET',
      //             xhrFields: { withCredentials: true },
      //    success:function(data)
      //    { alert(typeof(data)); 
      //     employee_data =csvflooddata.split(/\r?\n|\r/);
      //     var table_data = '<table class="table table-bordered table-striped">';
      //     for(var count = 0; count<employee_data.length; count++)
      //     {     
      //             //you will get acctual output in array
            
      //           cell_data = employee_data[count].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                
      //      table_data += '<tr id="roweve"  onclick="rowclick(this)">';
      //      for(var cell_count=0; cell_count<cell_data.length; cell_count++)
      //      {
      //       if(count === 0)
      //       {
      //        table_data += '<th>'+cell_data[cell_count]+'</th>';
               
      //       }
      //       else
      //       {
      //        table_data += '<td>'+cell_data[cell_count]+'</td>';
      //       }
      //      }
      //      table_data += '</tr>';
      //     }
      //     table_data += '</table>';
      //     $('#employee_table').html(table_data);
      //    }
      //   });
      //  });
       
      // });
       </script>





<!-- 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Leaflet Maps</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,200;0,400;0,700;1,400&display=swap"
        rel="stylesheet">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <link rel="stylesheet" href="./style.css" crossorigin="anonymous">
    
</head>

<body>
  <main> 
        <div   class="scroll gisdatalist">
            <div class="heading">
                <h2>Flood Data</h2>
            </div>
               <div id="Start"> <form  >
                    <label for="start-date">Flood Start date:</label>
                    <input type="date" id="startdate" name="birthday">
                    
                  </form></div>
                <div id="End">   <form action="/action_page.php">
                    <label for="end-date">Flood End date:</label>
                    <input type="date" id="enddate" name="birthday">
                    
                  </form>
                  </div>
              
                  <div class="dropdown" id="Countrydrop">
                  <form action="/action_page.php">
                    <label for="cars">Choose Country Name:</label>
                    
                    <select id="countries" name="countries">
                      <option value="india">India</option>
                      <option value="indonesia">Indonesia</option>
                      <option value="japan">Japan</option>
                      <option value="laos">Laos</option>
                      <option value="thailand">Thailand</option>
                    </select>
                </form>   
                   
                </div>
                <div id="satellites"> 
                    
            <form action="/action_page.php">
                <label>Choose satellites:</label>
                <input type="checkbox" id="sat1" name="sat1" value="Planet">
                <label for="vehicle1">Planet</label>  
                <input type="checkbox" id="sat2" name="sat2" value="DigitalGlobe">
                <label for="vehicle2">Digital Globe</label><br>
                <input type="checkbox" id="sat3" name="sat3" value="Sentinal-I">
                <label for="vehicle3">Sentinal-I</label>  
                <input type="checkbox" id="sat4" name="sat4" value="Sentinal-II">
                <label for="vehicle3">Sentinal-II</label> 
              </form>
            </div>
            <div id="submitbutton"> 
             <button type="button" onclick="getVal();"  class="btn btn-primary">
                <font color="white"> Submit</font>
    </button></div>
   <div id="daterange">  <h4 id="some">Flood Range</h4></div>
   <div class ="flooddataclass "id="datalist"  >
   
    
      
   </div>
        </div>
    <div id="map"></div></main>
 
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
    <script src="./app.js"></script>
    
  
</body>

</html>
<script>
var footprint;
var coordinatesarray;
var cell_data;
var actualdata;
var country;
var employee_data;
var flooddatasearch;
var csvflooddata;
 var ispaused=false;
 var issubmit=false;
 var startdate;
 var enddate;
 var setstart;
 var setend;
 var requireddata=[];
 var selectcountry;
   
   $(document).ready(function(){
  
    $.ajax({
     url:'https://agile-hollows-34401.herokuapp.com/flooddata',
     type: 'GET',
     
     success:function(allflood)
     { 
   
      actualdata=allflood;
      console.log(actualdata);
    if(typeof(actualdata)=="object"){
      issubmit=true;
    }
    
  
 }
     ,
     error:function(error)
     { 
      console.log(error);
       
      }
    });
  
   
  });
 
  function formatDate (input) {
  var datePart = input.match(/\d+/g),
  year = datePart[0] , // get only two digits
  month = datePart[1], day = datePart[2];

  return day+'/'+month+'/'+year;
}
   
function getVal(){

  
  var x = document.getElementById("startdate").value
   var  y= document.getElementById("enddate").value
     selectcountry= document.getElementById("countries").value;
    x = x.replace(/\-/g, '/');
    y=y.replace(/\-/g, '/');
     setstart=formatDate(x);
     setend=formatDate(y);
     
 

 
  // var flooddatasearch = JSON.parse(actualdata);
for(var i=0;i<actualdata[0]["FloodCSVData"].length;i++){
  actualdata[0]["FloodCSVData"][i]["geometry"]= JSON.stringify(actualdata[0]["FloodCSVData"][i]["geometry"]);
   
  
  if(i==actualdata[0]["FloodCSVData"].length-1){
    ispaused=true;
  }
 }

for(var j=0;j<actualdata.length;j++){

       
    
      startdate=actualdata[j]["StartDate"];
      enddate=actualdata[j]["EndDate"];
      country=actualdata[j]["CountryName"];
      var d1 = setstart.split("/");
var d2 =setend.split("/");
var c1 = startdate.split("/");
var c2=enddate.split("/");
var from = new Date(d1[2], parseInt(d1[1])-1, d1[0]);  // -1 because months are from 0 to 11
var to   = new Date(d2[2], parseInt(d2[1])-1, d2[0]);
var check1 = new Date(c1[2], parseInt(c1[1])-1, c1[0]);
var check2 = new Date(c2[2], parseInt(c2[1])-1, c2[0]);
if((check1 > from && check1 < to)&&(check2 > from && check2 < to)){
     console.log("in date range");
     requireddata.push(actualdata[j]["FloodCSVData"]);
}
// console.log(check1 > from && check1 < to);
// console.log("to");
// console.log(check2 > from && check2 < to);
}
console.log(requireddata);
//convert json to csv 
flooddatasearch=actualdata[0]["FloodCSVData"];
var fields = Object.keys(flooddatasearch[0])
var replacer = function(key, value) { return value === null ? '' : value } 
 csvflooddata =flooddatasearch.map(function(row){
  return fields.map(function(fieldName){
    return JSON.stringify(row[fieldName], replacer)
  }).join(',')
})
csvflooddata.unshift(fields.join(',')) // add header column
csvflooddata  =  csvflooddata.join('\r\n');
   
    document.getElementById("some").innerHTML="Flooddata "+ setstart +" to "+setend;
    // document.getElementById("load_data").innerHTML="Load Data";
    if(issubmit){
 var text = "<ol class='list'  ><br>";
    for (var i =0;i<re.length;i++)
    {   
     
      if(i>0){text=text+"<hr style='height:1px;border-width:0px;color:gray;background-color:gray'/>";}  
             text = text + "<li  name='load_data' id='#load_data'  onclick='Loadcsv("+i+");' ><img src='csvicon.png'  style='height:48px;width:48px; border-radius:25%;  border: 1px solid #0e75d3;'>"+"  "+" floodata </li> <br /> <div id='employee_table"+i+"' style='overflow: auto;'></div> " ;
            
    
    }
 text = text +"</ol>";
  }
  else{
    alert("submit again");
  }
 document.getElementById('datalist').innerHTML=text; 

 
 
 
    // document.getElementById("data2").innerHTML="employee1.csv";
    // document.getElementById("data3").innerHTML="employee2.csv";
    // document.getElementById("data4").innerHTML="employee3.csv";
}
function Loadcsv(i){
   
   
   if(ispaused){
 
  employee_data =csvflooddata.split(/\r?\n|\r/);
      var table_data = '<table class="table table-bordered table-striped"  > ';
      for(var count = 0; count<employee_data.length; count++)
      {     
              //you will get acctual output in array
        
            cell_data = employee_data[count].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            
       table_data += ' <tr id="roweve"  onclick="rowclick(this)"  >  ';
       for(var cell_count=0; cell_count<cell_data.length; cell_count++)
       {
        if(count === 0)
        {
         table_data += '  <th  >  '+cell_data[cell_count]+'</th>';
           
        }
        
        else{
          table_data += '<td>'+cell_data[cell_count]+'</td>';
        }
       }
       table_data += '</tr>';
      }
      table_data += '</table>';
      
      // for(var j=0;j<allflood.length;j++){
    // if(i==j){
  document.getElementById('employee_table'+i+'').style.height = 30+"vh";
   $('#employee_table'+i+'').html(table_data);
// } }
 
    }
     }


     
function rowclick(rowno){
 let msg=rowno.cells[5].innerHTML;
 
 var WithOutBrackets=msg.replace(/[\[\]']+/g,'');
 var me=WithOutBrackets.replace(/"/g,"");
         
//   var obj=  JSON.parse( WithOutBrackets   );
 //alert(typeof(me));
 //we have to do string to integer and understand about how array convert into chunk array

  var  coordinates=  me.split(',');
  console.log( coordinates);
const chunk =  coordinates => {
   const size = 2;
   const chunkedArray = [];
   for (let i = 0; i <  coordinates.length; i++) {
      const last = chunkedArray[chunkedArray.length - 1];
      if(!last || last.length === size){
         chunkedArray.push([ coordinates[i]]);
      }else{
         last.push( coordinates[i]);
      }
   };
   return chunkedArray;
};
 
       alert(chunk( coordinates));
    var states = [{
    "type": "Feature",
    "properties": {},
    "geometry": {
        "type": "Polygon",
        "coordinates":[[["129.86889616213875", "31.85092400331079"], ["130.13226059277255", "31.804015706859424"], ["130.11415527263486", "31.731335321675704"], ["129.85082873777677", "31.77787200251359"], ["129.86889616213875", "31.85092400331079"]]]
       }

}];
 states[0]["geometry"]["coordinates"]=[chunk( coordinates)];
console.log(states);
L.geoJSON(states, {
    style: function(feature) {
        switch (feature.properties.party) {
            case 'Republican': return {color: "#ff0000"};
            case 'Democrat':   return {color: "#0000ff"};
        }
    }
}).addTo(map);

}


 //  fetch("https://agile-hollows-34401.herokuapp.com/flooddata").then((response) =>{
    
//     return response.json();
//   }).then((actualdata)=>{
//     allflood=actualdata;
//     if(typeof(allflood)=="object"){
//       issubmit=true;
//     }
  
 
//   // var flooddatasearch = JSON.parse(actualdata);
// for(var i=0;i<actualdata[0]["FloodCSVData"].length;i++){
//   actualdata[0]["FloodCSVData"][i]["geometry"]= JSON.stringify(actualdata[0]["FloodCSVData"][i]["geometry"]);
   
  
//   if(i==actualdata[0]["FloodCSVData"].length-1){
//     ispaused=true;
//   }
//  }

// for(var j=0;j<actualdata.length;j++){
//       startdate=actualdata[j]["StartDate"];
//       enddate=actualdata[j]["EndDate"];
// }
  
 
// flooddatasearch=actualdata[0]["FloodCSVData"];
// var fields = Object.keys(flooddatasearch[0])
// var replacer = function(key, value) { return value === null ? '' : value } 
//  csvflooddata =flooddatasearch.map(function(row){
//   return fields.map(function(fieldName){
//     return JSON.stringify(row[fieldName], replacer)
//   }).join(',')
// })
// csvflooddata.unshift(fields.join(',')) // add header column
// csvflooddata  =  csvflooddata.join('\r\n');
 
 

//   }).catch((error)=>{
//     console.log(error);
//   });


//   $.ajax({
//   url: 'https://agile-hollows-34401.herokuapp.com/flooddata',
//   dataType: 'json',
//   success: function(data) {
//     console.log(data);
//   }
// });
// fetch('https://randomuser.me/api/?results=10').then(function(response) {
//   return response.json();
// }).then(function(json) {
//   let products = json;
//   initialize(products);
// }).catch(function(err) {
//   console.log('Fetch problem: ' + err.message);
// });

 
 


  //   $(document).ready(function(){
  //  $('#load_data').click(function(){ alert(country);
  //   $.ajax({
  //    url:'employee.csv',
  //    dataType:"text",
  //    crossOrigin: true,
  //             type: 'GET',
  //             xhrFields: { withCredentials: true },
  //    success:function(data)
  //    { alert(typeof(data)); 
  //     employee_data =csvflooddata.split(/\r?\n|\r/);
  //     var table_data = '<table class="table table-bordered table-striped">';
  //     for(var count = 0; count<employee_data.length; count++)
  //     {     
  //             //you will get acctual output in array
        
  //           cell_data = employee_data[count].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            
  //      table_data += '<tr id="roweve"  onclick="rowclick(this)">';
  //      for(var cell_count=0; cell_count<cell_data.length; cell_count++)
  //      {
  //       if(count === 0)
  //       {
  //        table_data += '<th>'+cell_data[cell_count]+'</th>';
           
  //       }
  //       else
  //       {
  //        table_data += '<td>'+cell_data[cell_count]+'</td>';
  //       }
  //      }
  //      table_data += '</tr>';
  //     }
  //     table_data += '</table>';
  //     $('#employee_table').html(table_data);
  //    }
  //   });
  //  });
   
  // });
   </script> -->



